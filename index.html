<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="index.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
    </head>
    <body>
        <div class="container">
            <h1>Nothing is lost!</h1>
            <div class="wrapper">
                <div class="left">
                    <textarea class="text" placeholder="Type something"></textarea>
                    <button class="display-btn">Done</button>
                </div>
                <div class="right">
                    <div class="btns">
                        <button class="do-btn" onclick="undo()">
                            <i class="fa fa-undo" aria-hidden="true"></i>
                        </button>
                        <button class="do-btn" onclick="redo()">
                            <i class="fa fa-repeat" aria-hidden="true"></i>
                        </button>
                        <button class="style-btn" onclick="transformText('b')"><b>B</b></button>
                        <button class="style-btn" onclick="transformText('i')"><i>I</i></button>
                        <button class="style-btn" onclick="transformText('u')"><u>U</u></button>
                    </div>
                    <p class="display"></p>
                </div>
            </div>
        </div>
        <script>
            const words = []
            const trash = []
            let text = ""
            let selectedTextObj = {}
            const textInput = document.getElementsByClassName('text')[0];
            const displayBtn = document.getElementsByClassName('display-btn')[0];
            const displayText = document.getElementsByClassName('display')[0];

            textInput.addEventListener('change', e => handleChange(e))
            displayBtn.addEventListener('click', () => handleSubmit())

            function handleChange(e){
                text = e.target.value;
            }

            function handleSubmit(){
                displayText.innerHTML = text;
                textInput.value = ""
                let j = 0
                for (let i = 0; i < text.length; i++){
                    if (text[i] === " "){
                        words.push(text.slice(j, i))
                        j = i+ 1
                    } 
                    if (i === text.length - 1){
                        words.push(text.slice(j, i+1))
                    }
                }
                console.log(text, words)
            }

            function undo(){
                trash.push(words.splice(words.length -1, 1))
                console.log(words)
                displayText.innerHTML = words.join(' ')
            }

            function redo(){
                if (trash.length > 0){
                    words.push(trash.slice(trash.length - 1, trash.length)[0])
                    trash.splice(trash.length - 1, 1)
                    displayText.innerHTML = words.join(' ')
                }
            }

            function getSelectedText(){
                selectedTextObj = window.getSelection()
                console.log(selectedTextObj)
            }

            function isCharacterALetter(char) {
                return (/[a-zA-Z]/).test(char)
            }

            function applyStyling(startInd, endInd, curText, command){
                console.log(startInd, endInd)
                let startStyleInd = startInd
                let endStyleInd = curText.length
                let m = 0
                let i = 0
                while (i < curText.length){
                    if (m === startInd){
                        startStyleInd = i
                    }
                    if (m === endInd){
                        endStyleInd = i
                    }
                    if ((i == 0 || i == curText.length - 1) && isCharacterALetter(curText[i])){
                        m += 1
                    }
                    if (i > 0 && i < curText.length - 1 && isCharacterALetter(curText[i-1]) && isCharacterALetter(curText[i+1]) ){
                        m += 1
                    }
                    if (i > 0 && i < curText.length - 1 && curText[i-1] === ' ' && isCharacterALetter(curText[i+1]) ){
                        m += 1
                    }
                    if (i > 0 && i < curText.length - 1 && isCharacterALetter(curText[i-1]) && curText[i+1] === ' ' ){
                        m += 1
                    }
                   
                    i += 1
                }
            
                displayText.innerHTML = curText.substring(0, startStyleInd) + `<${command}>${selectedTextObj.toString()}</${command}>` + curText.substring(endStyleInd, curText.length )

            }

            function transformText(command){
                if (selectedTextObj){
                    let curText = displayText.innerHTML;
                    let startInd = selectedTextObj.anchorOffset < selectedTextObj.extentOffset ? selectedTextObj.anchorOffset : selectedTextObj.extentOffset;
                    let endInd = selectedTextObj.anchorOffset > selectedTextObj.extentOffset ? selectedTextObj.anchorOffset : selectedTextObj.extentOffset;;
                    applyStyling(startInd, endInd, curText, command);
                }
            }

            displayText.onmouseup = getSelectedText;
            displayText.onkeyup = getSelectedText;

        </script>
    </body>
</html>